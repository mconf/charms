---

- hosts: all
  tasks:
    - name: Install dependencies
      become: yes
      apt:
        name:
          - apt-transport-https
          - curl
          - software-properties-common
          - python3-pip
        update_cache: yes

    - name: Install Node.js
      become: yes
      apt:
        name: nodejs
        state: latest

    - name: Install npm
      become: yes
      apt:
        name: npm
        state: latest

    - name: Install Chromium dependencies
      become: yes
      apt:
        name:
          - gconf-service
          - libappindicator3-1
          - libdbusmenu-gtk3-4
          - libgbm1
          - libwayland-server0
          - libasound2
          - libatk1.0-0
          - libatk-bridge2.0-0
          - libc6
          - libcairo2
          - libcups2
          - libdbus-1-3
          - libexpat1
          - libfontconfig1
          - libgcc1
          - libgconf-2-4
          - libgdk-pixbuf2.0-0
          - libglib2.0-0
          - libgtk-3-0
          - libnspr4
          - libpango-1.0-0
          - libpangocairo-1.0-0
          - libstdc++6
          - libx11-6
          - libx11-xcb1
          - libxcb1
          - libxcomposite1
          - libxcursor1
          - libxdamage1
          - libxext6
          - libxfixes3
          - libxi6
          - libxrandr2
          - libxrender1
          - libxss1
          - libxtst6
          - ca-certificates
          - fonts-liberation
          - libappindicator1
          - libnss3
          - lsb-release
          - xdg-utils
          - wget
        update_cache: yes

    - name: Upgrade dist
      become: yes
      apt:
        upgrade: dist

    - name: Copy run script
      copy:
        src: ../run
        dest: '{{ ansible_env.HOME }}/'
        mode: '0755'

    - name: Copy test scripts
      synchronize:
        src: ../../utils/mconfless/
        dest: '{{ ansible_env.HOME }}/mconfless/'

    - name: Install mconfless bot scripts
      community.general.npm:
        path: '{{ ansible_env.HOME }}/mconfless/'
