{
  "variables": {
      "user_ocid": "{{env `TF_VAR_oci_user_ocid`}}",
      "tenancy_ocid": "{{env `TF_VAR_oci_tenancy_ocid`}}",
      "fingerprint": "{{env `TF_VAR_oci_fingerprint`}}",
      "private_key_path": "{{env `TF_VAR_oci_private_key_path`}}",
      "region": "{{env `TF_VAR_oci_region`}}",
      "compartment_ocid": "{{env `TF_VAR_oci_compartment_ocid`}}",
      "availability_domain": "{{env `TF_VAR_oci_availability_domain`}}",
      "subnet_ocid": "{{env `TF_VAR_oci_subnet_ocid`}}"
  },

  "builders": [
    {
      "availability_domain": "{{user `availability_domain`}}",
      "region": "{{user `region`}}",
      "base_image_filter": {
        "operating_system": "Canonical Ubuntu",
        "operating_system_version": "20.04"
      },
      "user_ocid": "{{user `user_ocid`}}",
      "tenancy_ocid": "{{user `tenancy_ocid`}}",
      "subnet_ocid": "{{user `subnet_ocid`}}",
      "compartment_ocid": "{{user `compartment_ocid`}}",
      "fingerprint": "{{user `fingerprint`}}",
      "key_file": "{{user `private_key_path`}}",
      "ssh_private_key_file": "{{user `private_key_path`}}",
      "ssh_username": "ubuntu",
      "shape": "VM.Standard.E3.Flex",
      "shape_config": {
        "ocpus": 1,
        "memory_in_gbs": 2
      },
      "disk_size": "50",
      "image_name": "puppeteer-node",
      "type": "oracle-oci"
    }
  ],

  "provisioners": [
    {
      "type": "shell-local",
      "inline": [
        "ssh-keygen -f ~/.ssh/known_hosts -R {{ build `Host` }}",
        "cd ../ansible",
        "ANSIBLE_HOST_KEY_CHECKING=False ansible-playbook -i {{ build `Host` }}, --private-key {{ user `private_key_path` }} --extra-vars \"ansible_ssh_user=ubuntu\" install.yml"
      ]
    }
  ]
}
